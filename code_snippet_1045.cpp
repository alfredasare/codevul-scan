Sure, here's the fixed version of the code that addresses the issue of integer overflow leading to buffer overflow (CWE-476, CVE-2017-6